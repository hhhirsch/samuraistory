(()=>{var a={};a.id=175,a.ids=[175],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1916:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>au,patchFetch:()=>at,routeModule:()=>ap,serverHooks:()=>as,workAsyncStorage:()=>aq,workUnitAsyncStorage:()=>ar});var d={};c.r(d),c.d(d,{POST:()=>ao});var e=c(5736),f=c(9117),g=c(4044),h=c(9326),i=c(2324),j=c(261),k=c(4290),l=c(5328),m=c(8928),n=c(6595),o=c(3421),p=c(7679),q=c(1681),r=c(3446),s=c(6439),t=c(1356),u=c(641),v=Object.defineProperty,w={};function x(a){return/^http(s?):/.test(a)||a.startsWith("/")}((a,b)=>{for(var c in b)v(a,c,{get:b[c],enumerable:!0})})(w,{audioClassification:()=>I,audioToAudio:()=>L,automaticSpeechRecognition:()=>J,chatCompletion:()=>af,chatCompletionStream:()=>ag,documentQuestionAnswering:()=>ah,featureExtraction:()=>U,fillMask:()=>V,imageClassification:()=>M,imageSegmentation:()=>N,imageToImage:()=>S,imageToText:()=>O,objectDetection:()=>P,questionAnswering:()=>W,request:()=>E,sentenceSimilarity:()=>X,streamingRequest:()=>G,summarization:()=>Y,tableQuestionAnswering:()=>Z,tabularClassification:()=>ak,tabularRegression:()=>aj,textClassification:()=>$,textGeneration:()=>aa,textGenerationStream:()=>ab,textToImage:()=>Q,textToSpeech:()=>K,tokenClassification:()=>ac,translation:()=>ad,visualQuestionAnswering:()=>ai,zeroShotClassification:()=>ae,zeroShotImageClassification:()=>T});var y=new Map,z="https://huggingface.co";async function A(a,b,c){if(x(a))return null;let d=`${a}:${b}`,e=y.get(d);if(e&&e.date<new Date(Date.now()-6e5)&&(y.delete(d),e=void 0),void 0===e){let f=await (c?.fetch??fetch)(`${z}/api/models/${a}?expand[]=pipeline_tag`,{headers:b?{Authorization:`Bearer ${b}`}:{}}).then(a=>a.json()).then(a=>a.pipeline_tag).catch(()=>null);if(!f)return null;e={task:f,date:new Date},y.set(d,{task:f,date:new Date}),y.size>1e3&&y.delete(y.keys().next().value)}return e.task}var B="https://api-inference.huggingface.co",C=null;async function D(a,b){let c,{accessToken:d,endpointUrl:e,...f}=a,{model:g}=a,{forceTask:h,includeCredentials:i,taskHint:j,wait_for_model:k,use_cache:l,dont_load_model:m,chatCompletion:n}=b??{},o={};if(d&&(o.Authorization=`Bearer ${d}`),!g&&!C&&j){let a=await fetch(`${z}/api/tasks`);a.ok&&(C=await a.json())}if(!g&&C&&j){let a=C[j];a&&(g=a.models[0].id)}if(!g)throw Error("No model provided, and no default model found for this task");let p="data"in a&&!!a.data;p||(o["Content-Type"]="application/json"),k&&(o["X-Wait-For-Model"]="true"),!1===l&&(o["X-Use-Cache"]="false"),m&&(o["X-Load-Model"]="0");let q=(()=>{if(e&&x(g))throw TypeError("Both model and endpointUrl cannot be URLs");return x(g)?(console.warn("Using a model URL is deprecated, please use the `endpointUrl` parameter instead"),g):e||(h?`${B}/pipeline/${h}/${g}`:`${B}/models/${g}`)})();return n&&!q.endsWith("/chat/completions")&&(q+="/v1/chat/completions"),"string"==typeof i?c=i:!0===i&&(c="include"),{url:q,info:{headers:o,method:"POST",body:p?a.data:JSON.stringify({...f.model&&x(f.model)?function(a,b){let c=Array.isArray(b)?b:[b],d=Object.keys(a).filter(a=>!c.includes(a));return Object.assign({},...d.map(b=>{if(void 0!==a[b])return{[b]:a[b]}}))}(f,"model"):f}),...c&&{credentials:c},signal:b?.signal}}}async function E(a,b){let{url:c,info:d}=await D(a,b),e=await (b?.fetch??fetch)(c,d);if(b?.retry_on_error!==!1&&503===e.status&&!b?.wait_for_model)return E(a,{...b,wait_for_model:!0});if(!e.ok){if(e.headers.get("Content-Type")?.startsWith("application/json")){let c=await e.json();if([400,422,404,500].includes(e.status)&&b?.chatCompletion)throw Error(`Server ${a.model} does not seem to support chat completion. Error: ${c.error}`);if(c.error)throw Error(JSON.stringify(c.error))}throw Error("An error occurred while fetching the blob")}return e.headers.get("Content-Type")?.startsWith("application/json")?await e.json():await e.blob()}function F(){return{data:"",event:"",id:"",retry:void 0}}async function*G(a,b){var c;let d,e,f,g,{url:h,info:i}=await D({...a,stream:!0},b),j=await (b?.fetch??fetch)(h,i);if(b?.retry_on_error!==!1&&503===j.status&&!b?.wait_for_model)return yield*G(a,{...b,wait_for_model:!0});if(!j.ok){if(j.headers.get("Content-Type")?.startsWith("application/json")){let c=await j.json();if([400,422,404,500].includes(j.status)&&b?.chatCompletion)throw Error(`Server ${a.model} does not seem to support chat completion. Error: ${c.error}`);if(c.error)throw Error(c.error)}throw Error(`Server response contains error: ${j.status}`)}if(!j.headers.get("content-type")?.startsWith("text/event-stream"))throw Error("Server does not support event stream content type, it returned "+j.headers.get("content-type"));if(!j.body)return;let k=j.body.getReader(),l=[],m=(c=function(a,b,c){let d=F(),e=new TextDecoder;return function(f,g){if(0===f.length)c?.(d),d=F();else if(g>0){let c=e.decode(f.subarray(0,g)),h=g+(32===f[g+1]?2:1),i=e.decode(f.subarray(h));switch(c){case"data":d.data=d.data?d.data+"\n"+i:i;break;case"event":d.event=i;break;case"id":a(d.id=i);break;case"retry":let j=parseInt(i,10);isNaN(j)||b(d.retry=j)}}}}(()=>{},()=>{},a=>{l.push(a)}),g=!1,function(a){void 0===d?(d=a,e=0,f=-1):d=function(a,b){let c=new Uint8Array(a.length+b.length);return c.set(a),c.set(b,a.length),c}(d,a);let b=d.length,h=0;for(;e<b;){g&&(10===d[e]&&(h=++e),g=!1);let a=-1;for(;e<b&&-1===a;++e)switch(d[e]){case 58:-1===f&&(f=e-h);break;case 13:g=!0;case 10:a=e}if(-1===a)break;c(d.subarray(h,a),f),h=e,f=-1}h===b?d=void 0:0!==h&&(d=d.subarray(h),e-=h)});try{for(;;){let{done:a,value:b}=await k.read();if(a)return;for(let a of(m(b),l))if(a.data.length>0){if("[DONE]"===a.data)return;let b=JSON.parse(a.data);if("object"==typeof b&&null!==b&&"error"in b)throw Error(b.error);yield b}l=[]}}finally{k.releaseLock()}}var H=class extends TypeError{constructor(a){super(`Invalid inference output: ${a}. Use the 'request' method with the same parameters to do a custom call with no type checking.`),this.name="InferenceOutputError"}};async function I(a,b){let c=await E(a,{...b,taskHint:"audio-classification"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a.label&&"number"==typeof a.score)))throw new H("Expected Array<{label: string, score: number}>");return c}async function J(a,b){let c=await E(a,{...b,taskHint:"automatic-speech-recognition"});if("string"!=typeof c?.text)throw new H("Expected {text: string}");return c}async function K(a,b){let c=await E(a,{...b,taskHint:"text-to-speech"});if(!(c&&c instanceof Blob))throw new H("Expected Blob");return c}async function L(a,b){let c=await E(a,{...b,taskHint:"audio-to-audio"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a.label&&"string"==typeof a.blob&&"string"==typeof a["content-type"])))throw new H("Expected Array<{label: string, blob: string, content-type: string}>");return c}async function M(a,b){let c=await E(a,{...b,taskHint:"image-classification"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a.label&&"number"==typeof a.score)))throw new H("Expected Array<{label: string, score: number}>");return c}async function N(a,b){let c=await E(a,{...b,taskHint:"image-segmentation"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a.label&&"string"==typeof a.mask&&"number"==typeof a.score)))throw new H("Expected Array<{label: string, mask: string, score: number}>");return c}async function O(a,b){let c=(await E(a,{...b,taskHint:"image-to-text"}))?.[0];if("string"!=typeof c?.generated_text)throw new H("Expected {generated_text: string}");return c}async function P(a,b){let c=await E(a,{...b,taskHint:"object-detection"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a.label&&"number"==typeof a.score&&"number"==typeof a.box.xmin&&"number"==typeof a.box.ymin&&"number"==typeof a.box.xmax&&"number"==typeof a.box.ymax)))throw new H("Expected Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return c}async function Q(a,b){let c=await E(a,{...b,taskHint:"text-to-image"});if(!(c&&c instanceof Blob))throw new H("Expected Blob");return c}function R(a){if(globalThis.Buffer)return globalThis.Buffer.from(a).toString("base64");{let b=[];return a.forEach(a=>{b.push(String.fromCharCode(a))}),globalThis.btoa(b.join(""))}}async function S(a,b){let c;c=a.parameters?{...a,inputs:R(new Uint8Array(a.inputs instanceof ArrayBuffer?a.inputs:await a.inputs.arrayBuffer()))}:{accessToken:a.accessToken,model:a.model,data:a.inputs};let d=await E(c,{...b,taskHint:"image-to-image"});if(!(d&&d instanceof Blob))throw new H("Expected Blob");return d}async function T(a,b){let c={...a,inputs:{image:R(new Uint8Array(a.inputs.image instanceof ArrayBuffer?a.inputs.image:await a.inputs.image.arrayBuffer()))}},d=await E(c,{...b,taskHint:"zero-shot-image-classification"});if(!(Array.isArray(d)&&d.every(a=>"string"==typeof a.label&&"number"==typeof a.score)))throw new H("Expected Array<{label: string, score: number}>");return d}async function U(a,b){let c=a.model?await A(a.model,a.accessToken,b):void 0,d=await E(a,{...b,taskHint:"feature-extraction",..."sentence-similarity"===c&&{forceTask:"feature-extraction"}}),e=(a,b,c=0)=>!(c>b)&&(a.every(a=>Array.isArray(a))?a.every(a=>e(a,b,c+1)):a.every(a=>"number"==typeof a));if(!(Array.isArray(d)&&e(d,3,0)))throw new H("Expected Array<number[][][] | number[][] | number[] | number>");return d}async function V(a,b){let c=await E(a,{...b,taskHint:"fill-mask"});if(!(Array.isArray(c)&&c.every(a=>"number"==typeof a.score&&"string"==typeof a.sequence&&"number"==typeof a.token&&"string"==typeof a.token_str)))throw new H("Expected Array<{score: number, sequence: string, token: number, token_str: string}>");return c}async function W(a,b){let c=await E(a,{...b,taskHint:"question-answering"});if(!("object"==typeof c&&c&&"string"==typeof c.answer&&"number"==typeof c.end&&"number"==typeof c.score&&"number"==typeof c.start))throw new H("Expected {answer: string, end: number, score: number, start: number}");return c}async function X(a,b){let c=a.model?await A(a.model,a.accessToken,b):void 0,d=await E(a,{...b,taskHint:"sentence-similarity",..."feature-extraction"===c&&{forceTask:"sentence-similarity"}});if(!(Array.isArray(d)&&d.every(a=>"number"==typeof a)))throw new H("Expected number[]");return d}async function Y(a,b){let c=await E(a,{...b,taskHint:"summarization"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a?.summary_text)))throw new H("Expected Array<{summary_text: string}>");return c?.[0]}async function Z(a,b){let c=await E(a,{...b,taskHint:"table-question-answering"});if(!("string"==typeof c?.aggregator&&"string"==typeof c.answer&&Array.isArray(c.cells)&&c.cells.every(a=>"string"==typeof a)&&Array.isArray(c.coordinates)&&c.coordinates.every(a=>Array.isArray(a)&&a.every(a=>"number"==typeof a))))throw new H("Expected {aggregator: string, answer: string, cells: string[], coordinates: number[][]}");return c}async function $(a,b){let c=(await E(a,{...b,taskHint:"text-classification"}))?.[0];if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a?.label&&"number"==typeof a.score)))throw new H("Expected Array<{label: string, score: number}>");return c}function _(a){return Array.isArray(a)?a:[a]}async function aa(a,b){let c=_(await E(a,{...b,taskHint:"text-generation"}));if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a?.generated_text)))throw new H("Expected Array<{generated_text: string}>");return c?.[0]}async function*ab(a,b){yield*G(a,{...b,taskHint:"text-generation"})}async function ac(a,b){let c=_(await E(a,{...b,taskHint:"token-classification"}));if(!(Array.isArray(c)&&c.every(a=>"number"==typeof a.end&&"string"==typeof a.entity_group&&"number"==typeof a.score&&"number"==typeof a.start&&"string"==typeof a.word)))throw new H("Expected Array<{end: number, entity_group: string, score: number, start: number, word: string}>");return c}async function ad(a,b){let c=await E(a,{...b,taskHint:"translation"});if(!(Array.isArray(c)&&c.every(a=>"string"==typeof a?.translation_text)))throw new H("Expected type Array<{translation_text: string}>");return c?.length===1?c?.[0]:c}async function ae(a,b){let c=_(await E(a,{...b,taskHint:"zero-shot-classification"}));if(!(Array.isArray(c)&&c.every(a=>Array.isArray(a.labels)&&a.labels.every(a=>"string"==typeof a)&&Array.isArray(a.scores)&&a.scores.every(a=>"number"==typeof a)&&"string"==typeof a.sequence)))throw new H("Expected Array<{labels: string[], scores: number[], sequence: string}>");return c}async function af(a,b){let c=await E(a,{...b,taskHint:"text-generation",chatCompletion:!0});if(!("object"==typeof c&&Array.isArray(c?.choices)&&"number"==typeof c?.created&&"string"==typeof c?.id&&"string"==typeof c?.model&&"string"==typeof c?.system_fingerprint&&"object"==typeof c?.usage))throw new H("Expected ChatCompletionOutput");return c}async function*ag(a,b){yield*G(a,{...b,taskHint:"text-generation",chatCompletion:!0})}async function ah(a,b){let c={...a,inputs:{question:a.inputs.question,image:R(new Uint8Array(a.inputs.image instanceof ArrayBuffer?a.inputs.image:await a.inputs.image.arrayBuffer()))}},d=_(await E(c,{...b,taskHint:"document-question-answering"}))?.[0];if("string"!=typeof d?.answer||"number"!=typeof d.end&&void 0!==d.end||"number"!=typeof d.score&&void 0!==d.score||"number"!=typeof d.start&&void 0!==d.start)throw new H("Expected Array<{answer: string, end?: number, score?: number, start?: number}>");return d}async function ai(a,b){let c={...a,inputs:{question:a.inputs.question,image:R(new Uint8Array(a.inputs.image instanceof ArrayBuffer?a.inputs.image:await a.inputs.image.arrayBuffer()))}},d=(await E(c,{...b,taskHint:"visual-question-answering"}))?.[0];if("string"!=typeof d?.answer||"number"!=typeof d.score)throw new H("Expected Array<{answer: string, score: number}>");return d}async function aj(a,b){let c=await E(a,{...b,taskHint:"tabular-regression"});if(!(Array.isArray(c)&&c.every(a=>"number"==typeof a)))throw new H("Expected number[]");return c}async function ak(a,b){let c=await E(a,{...b,taskHint:"tabular-classification"});if(!(Array.isArray(c)&&c.every(a=>"number"==typeof a)))throw new H("Expected number[]");return c}var al=class{accessToken;defaultOptions;constructor(a="",b={}){for(let[c,d]of(this.accessToken=a,this.defaultOptions=b,Object.entries(w)))Object.defineProperty(this,c,{enumerable:!1,value:(c,e)=>d({...c,accessToken:a},{...b,...e})})}endpoint(a){return new am(a,this.accessToken,this.defaultOptions)}},am=class{constructor(a,b="",c={}){for(let[d,e]of Object.entries(w))Object.defineProperty(this,d,{enumerable:!1,value:(d,f)=>e({...d,accessToken:b,endpointUrl:a},{...c,...f})})}};let an=new al(process.env.HUGGINGFACE_API_TOKEN);async function ao(a){try{let b=await a.json();if(!b.prompt||"string"!=typeof b.prompt||b.prompt.trim().length<5)return u.NextResponse.json({success:!1,error:"Prompt ist erforderlich (min. 5 Zeichen)"},{status:400});let{prompt:c,negative_prompt:d="blurry, low quality, distorted, watermark",width:e=1024,height:f=1024}=b,g=null;for(let a=1;a<=3;a++)try{let a=await an.textToImage({model:"stabilityai/stable-diffusion-xl-base-1.0",inputs:c,parameters:{negative_prompt:d,width:e,height:f,num_inference_steps:30}}),b=await a.arrayBuffer(),g=Buffer.from(b).toString("base64"),h=`image/png;base64,${g}`;return u.NextResponse.json({success:!0,imageData:h})}catch(b){if(g=b,503===g.status&&a<3){let b=1e3*(g.estimated_time||2);console.log(`[HF] Model loading, retry ${a}/3 in ${b}ms`),await new Promise(a=>setTimeout(a,b));continue}break}if(console.error("[HF] Image generation failed after retries:",g),g?.status===503)return u.NextResponse.json({success:!1,error:"Modell wird noch geladen. Bitte in 20-30 Sekunden erneut versuchen.",retryAfter:30},{status:503});if(g?.status===429)return u.NextResponse.json({success:!1,error:"Rate limit erreicht. Bitte warten Sie einen Moment."},{status:429});return u.NextResponse.json({success:!1,error:"Bildgenerierung fehlgeschlagen. Bitte erneut versuchen."},{status:500})}catch(a){if(a instanceof SyntaxError)return u.NextResponse.json({success:!1,error:"Ung\xfcltiges JSON im Request"},{status:400});return console.error("[API] Unexpected error:",a),u.NextResponse.json({success:!1,error:"Interner Serverfehler"},{status:500})}}let ap=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/generate-image/route",pathname:"/api/generate-image",filename:"route",bundlePath:"app/api/generate-image/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/runner/work/samuraistory/samuraistory/app/api/generate-image/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:aq,workUnitAsyncStorage:ar,serverHooks:as}=ap;function at(){return(0,g.patchFetch)({workAsyncStorage:aq,workUnitAsyncStorage:ar})}async function au(a,b,c){var d;let e="/api/generate-image/route";"/index"===e&&(e="/");let g=await ap.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||ap.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===ap.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>ap.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},M=new k.NodeNextRequest(a),N=new k.NodeNextResponse(b),O=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(b));try{let d=async c=>ap.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=L.renderOpts.fetchMetrics;let i=L.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,o.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await ap.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await ap.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(M,N,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await ap.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(M,N,new Response(null,{status:500})),null}}},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},8335:()=>{},9121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[331,692],()=>b(b.s=1916));module.exports=c})();